{
  "experiment_name": "mask2former_iris_ultra_fast",
  "description": "ULTRA-FAST training for Kaggle 4-5 hours",
  
  "model": {
    "architecture": "mask2former",
    "model_name": "facebook/mask2former-swin-small-coco-panoptic",
    "model_type": "enhanced",
    "num_labels": 2,
    "num_queries": 10,
    "add_boundary_head": false,
    "freeze_backbone": true,
    "freeze_epochs": 999,
    "use_checkpoint": false
  },
  
  "data": {
    "dataset_dir": "/kaggle/input/your-dataset-name/dataset",
    "dataset_root": "/kaggle/input/your-dataset-name/dataset",
    "images_dir": "/kaggle/input/your-dataset-name/dataset/images",
    "masks_dir": "/kaggle/input/your-dataset-name/dataset/masks",
    "image_size": 320,
    "train_val_split": 0.85,
    "subject_aware_split": true,
    "use_subject_split": true,
    "preserve_aspect_ratio": false,
    "preserve_aspect": false,
    "num_workers": 0,
    "pin_memory": false,
    "batch_size": 4
  },
  
  "training": {
    "num_epochs": 40,
    "epochs": 40,
    "batch_size": 4,
    "accumulation_steps": 2,
    "learning_rate": 5e-5,
    "base_lr": 5e-5,
    "weight_decay": 0.01,
    "warmup_epochs": 1,
    "min_lr": 1e-7,
    "patience": 8,
    "save_frequency": 10,
    "eval_freq": 2,
    "evaluate_every": 2,
    "log_freq": 100,
    "gradient_clip": 1.0,
    "mixed_precision": true,
    "steps_per_epoch": 1000,
    
    "optimizer": {
      "type": "adamw",
      "base_lr": 5e-5,
      "learning_rate": 5e-5,
      "betas": [0.9, 0.999],
      "eps": 1e-8,
      "weight_decay": 0.01
    },
    
    "scheduler": {
      "type": "cosine",
      "warmup_steps": 100,
      "min_lr_ratio": 0.01,
      "min_lr": 1e-7,
      "power": 0.9
    },
    
    "early_stopping": {
      "enabled": true,
      "patience": 8,
      "min_delta": 0.0005,
      "metric": "mean_iou",
      "mode": "max"
    },
    
    "gradient_clipping": {
      "enabled": true,
      "max_norm": 1.0
    }
  },
  
  "optimizer": {
    "type": "adamw",
    "base_lr": 5e-5,
    "learning_rate": 5e-5,
    "betas": [0.9, 0.999],
    "eps": 1e-8,
    "weight_decay": 0.01
  },
  
  "scheduler": {
    "type": "cosine",
    "warmup_steps": 100,
    "min_lr_ratio": 0.01,
    "min_lr": 1e-7,
    "power": 0.9
  },
  
  "loss": {
    "loss_type": "combined",
    "ce_weight": 0.5,
    "dice_weight": 0.5,
    "boundary_weight": 0.0,
    "mask2former_weight": 1.0,
    "aux_weight": 0.1,
    "use_focal": false,
    "focal_alpha": null,
    "focal_gamma": 2.0,
    "class_weights": [1.0, 15.0]
  },
  
  "augmentation": {
    "horizontal_flip": 0.5,
    "vertical_flip": 0.0,
    "rotation_limit": 5,
    "scale_limit": 0.05,
    "brightness_contrast": {
      "brightness_limit": 0.15,
      "contrast_limit": 0.15,
      "p": 0.2
    },
    "hue_saturation": {
      "hue_shift_limit": 5,
      "sat_shift_limit": 10,
      "val_shift_limit": 10,
      "p": 0.1
    },
    "clahe": {
      "clip_limit": 2.0,
      "tile_grid_size": [8, 8],
      "p": 0.1
    },
    "blur": {
      "blur_limit": 3,
      "p": 0.05
    },
    "noise": {
      "var_limit": 5.0,
      "p": 0.0
    }
  },
  
  "evaluation": {
    "metrics": [
      "pixel_accuracy",
      "mean_iou",
      "mean_dice",
      "class_iou",
      "class_dice"
    ],
    "evaluate_every": 2,
    "save_predictions": false,
    "save_best_model": true,
    "save_last_model": true
  },
  
  "checkpointing": {
    "save_dir": "/kaggle/working/outputs/mask2former_iris",
    "save_frequency": 10,
    "keep_best_n": 1,
    "keep_last_n": 1,
    "monitor_metric": "mean_iou",
    "monitor_mode": "max"
  },
  
  "logging": {
    "use_wandb": false,
    "wandb_project": "iris-segmentation-mask2former",
    "wandb_entity": null,
    "log_frequency": 100,
    "log_images_frequency": 999999,
    "log_gradients": false,
    "save_predictions_samples": 0
  },
  
  "visualization": {
    "enabled": false,
    "save_frequency": 999,
    "num_samples": 0,
    "save_dir": "/kaggle/working/outputs/mask2former_iris/visualizations"
  },
  
  "inference": {
    "checkpoint_path": "/kaggle/working/outputs/mask2former_iris/checkpoints/best.pt",
    "batch_size": 8,
    "device": "cuda",
    "use_amp": true,
    "confidence_threshold": 0.5
  },
  
  "hardware": {
    "device": "cuda",
    "gpu_ids": [0],
    "distributed": false,
    "world_size": 1,
    "find_unused_parameters": false
  },
  
  "reproducibility": {
    "seed": 42,
    "deterministic": false,
    "benchmark": true
  },
  
  "num_classes": 2,
  "class_names": ["background/pupil", "iris"],
  "class_distribution": [0.95, 0.05],
  "project_name": "iris-segmentation-ultra-fast",
  "run_name": "mask2former-ultra-fast-4h",
  "tags": ["mask2former", "iris", "ultra-fast", "kaggle"],
  "output_dir": "/kaggle/working/outputs/mask2former_iris",
  
  "targets": {
    "mean_iou": 0.85,
    "mean_dice": 0.88,
    "iris_iou": 0.85,
    "boundary_f1": 0.0,
    "inference_fps": 30
  },
  
  "notes": {
    "ultra_fast_mode": true,
    "target_time": "4-5 hours",
    "optimization_strategies": [
      "✅ num_epochs: 80 → 40 (50% FASTER)",
      "✅ image_size: 384 → 320 (30% FASTER per epoch)",
      "✅ num_queries: 20 → 10 (40% FASTER forward pass)",
      "✅ batch_size: 2 → 4 (2x throughput)",
      "✅ accumulation_steps: 4 → 2 (less overhead)",
      "✅ eval_freq: 1 → 2 (50% less validation)",
      "✅ freeze_backbone: ALWAYS (no backward on backbone)",
      "✅ boundary_head: DISABLED (unnecessary)",
      "✅ augmentation: MINIMAL (faster loading)",
      "✅ warmup_epochs: 2 → 1 (faster convergence)",
      "✅ patience: 15 → 8 (stop earlier)",
      "✅ learning_rate: 3e-5 → 5e-5 (faster convergence)"
    ],
    "speed_breakdown": {
      "per_epoch": "~6-7 minutes",
      "40_epochs": "~4-5 hours",
      "validation": "~1 minute per 2 epochs",
      "checkpointing": "~30 seconds per 10 epochs"
    },
    "expected_performance": {
      "mean_iou": "0.85-0.87",
      "mean_dice": "0.88-0.90",
      "note": "Slightly lower than 10h training but MUCH faster"
    },
    "memory_usage": {
      "gpu_vram": "~10GB (comfortable on P100 16GB)",
      "system_ram": "~8GB (comfortable on Kaggle 16GB)"
    },
    "further_speedup": {
      "if_still_slow": [
        "1. Reduce image_size to 256 (risky for accuracy)",
        "2. Use DistilBERT-style student model",
        "3. Train only on subset (50% data)",
        "4. Use FP16 more aggressively"
      ]
    },
    "tradeoffs": {
      "pros": [
        "4-5h training time",
        "Still good performance (0.85+ mIoU)",
        "Fits Kaggle limits easily"
      ],
      "cons": [
        "Slightly lower accuracy vs 10h training",
        "Less robust to edge cases",
        "No boundary prediction"
      ]
    }
  }
}